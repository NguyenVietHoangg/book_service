var storiesLimit=30;function onload(){var t=window.location.href.trim();window.layout=document.getElementById("environment").getAttribute("title"),t.includes("/story/")?saveStory(t):t.includes("/chapter/")?saveChapter(t):t.includes("/watched")&&watchedShow()}function saveStory(o){setTimeout(function(){for(var t=JSON.parse(localStorage.getItem("truyen_da_xem")||"[]"),e=!1,r=0;r<t.length;r++)if(t[r].storyURL==o){e=!0;break}e||(console.log("not found"),t.length>=storiesLimit&&t.splice(-1,1),t.unshift({storyURL:o,storyTitle:document.getElementById("book_page_cover").getAttribute("title").trim(),storyCover:document.getElementById("book_page_cover").getAttribute("src").trim(),chapterURL:!1,chapterTitle:!1}),localStorage.setItem("truyen_da_xem",JSON.stringify(t)))},5e3)}function saveChapter(i){setTimeout(function(){for(var t=document.getElementById("story-href").getAttribute("href").trim(),e=JSON.parse(localStorage.getItem("truyen_da_xem")||"[]"),r=!1,o=0;o<e.length;o++)if(e[o].storyURL==t){r=!0,e[o].chapterURL!=i&&(e[o].chapterURL=i,e[o].chapterTitle=document.getElementById("story-href").getAttribute("chapter-title").trim());break}r||(console.log("not found"),e.length>=storiesLimit&&e.splice(-1,1),e.unshift({storyURL:t,storyTitle:document.getElementById("story-href").getAttribute("title").trim(),storyCover:document.getElementById("story-href").getAttribute("cover-data").trim(),chapterURL:i,chapterTitle:document.getElementById("story-href").getAttribute("chapter-title").trim()})),localStorage.setItem("truyen_da_xem",JSON.stringify(e))},5e3)}function watchedShow(){setTimeout(function(){var t=JSON.parse(localStorage.getItem("truyen_da_xem")||"[]");if(t.length){for(var e=[],r=0;r<t.length;r++){var o=r%5==0?"prepend-1":r%4==0?"last":"";e.push(("desktop"==window.layout?itemStoryDesktop:itemStoryMobile)(o,t[r]))}document.getElementById("da-xem").innerHTML=e.join("")}else document.getElementById("da-xem").innerHTML='<center><p style="font-size: 18px; font-weight: bold;">Bạn chưa xem truyện nào</p></center>'},100)}function itemStoryDesktop(t,e){var r=e.chapterURL||e.storyURL,o=e.chapterTitle?e.storyTitle+" - "+e.chapterTitle:e.storyTitle;return['<div class="span-3 resize invisible-colborder ',t,'">','<a rel="canonical" href="',r,'">','<div class="cover-highlight center">','<img class="cover large-cover" alt="',o,'" src="',e.storyCover,'" title="',o,'"></div>','<div class="center large-cover-button" id="store_item_links_9192">','<h3 style="font-size: 15px;"><span>',o,"</span></h3>","</div></a></div>"].join("")}function itemStoryMobile(t,e){var r=e.chapterURL||e.storyURL,o=e.chapterTitle?e.storyTitle+" - "+e.chapterTitle:e.storyTitle;return["<li>",'<img class="cover mini-cover '+t+'" alt="'+o+'" src="'+e.storyCover+'" title="'+o+'"><div id="store_item_links_2592671" data-protected="true">','<h3 class="fb-blue small-bottom-margin">'+o+"</h3>",'<h6 class="charcoal"><span class="gray"> M MT </span></h6>','<a class="buy" rel="canonical" href="'+r+'" data-label="'+o+'">Xem tiếp</a>',"</div>","</li>"].join("")}