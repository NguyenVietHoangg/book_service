var Zepto=function(){var n,r,i,o,a,s=[].slice,c=window.document;function e(t){return new RegExp("(^|\\s)"+t+"(\\s|$)")}function u(t){return t.filter(function(t){return t!==a&&null!==t})}function l(t){return t.replace(/-+(.)?/g,function(t,e){return e?e.toUpperCase():""})}function h(t,e){this.dom=t||[],this.length=this.dom.length,this.selector=e||""}function f(t,e){if(t==c)return new h;if(e!==a)return f(e).find(t);if("function"==typeof t)return f(c).ready(t);var n=t instanceof h?t.dom:t instanceof Array?u(t):t instanceof Element||t===window?[t]:i.test(t)?function(t){o.innerHTML=(""+t).trim();var e=s.call(o.childNodes);return o.innerHTML="",e}(t):r(c,t);return new h(n,t)}String.prototype.trim===a&&(String.prototype.trim=function(){return this.replace(/^\s+/,"").replace(/\s+$/,"")}),i=/^\s*<.+>/,o=c.createElement("div"),f.extend=function(t,e){for(n in e)t[n]=e[n];return t},f.qsa=r=function(t,e){return s.call(t.querySelectorAll(e))},f.fn={ready:function(t){return c.addEventListener("DOMContentLoaded",t,!1),this},get:function(t){return t===a?this.dom:this.dom[t]},size:function(){return this.length},remove:function(){return this.each(function(){this.parentNode.removeChild(this)})},each:function(n){return this.dom.forEach(function(t,e){n.call(t,e,t)}),this},filter:function(e){return f(this.dom.filter(function(t){return 0<=r(t.parentNode,e).indexOf(t)}))},is:function(t){return 0<this.length&&0<f(this.dom[0]).filter(t).length},first:function(){return f(this.get(0))},last:function(){return f(this.get(this.length-1))},find:function(e){var t=1==this.length?r(this.get(0),e):this.dom.map(function(t){return r(t,e)}).reduce(function(t,e){return t.concat(e)},[]);return f(t)},closest:function(t,e){var n=this.dom[0],i=r(e!==a?e:c,t);for(0===i.length&&(n=null);n&&n!==c&&i.indexOf(n)<0;)n=n.parentNode;return f(n)},parents:function(t){for(var e=[],n=this.get();0<n.length;)n=u(n.map(function(t){if((t=t.parentNode)&&t!==c&&e.indexOf(t)<0)return e.push(t),t}));return e=f(e),t===a?e:e.filter(t)},parent:function(t){var e,n=[];return this.each(function(){(e=this.parentNode)&&n.indexOf(e)<0&&n.push(e)}),n=f(n),t===a?n:n.filter(t)},show:function(){return this.each(function(){f(this).css("display",this.oldDisplay),"none"==f(this).css("display")&&f(this).css("display","block")})},hide:function(){return this.each(function(){var t=f(this).css("display");this.oldDisplay="none"!=t?t:a,f(this).css("display","none")})},toggle:function(){return this.each(function(){"none"==f(this).css("display")?f(this).show():f(this).hide()})},pluck:function(e){return this.dom.map(function(t){return t[e]})},prev:function(){return f(this.pluck("previousElementSibling"))},next:function(){return f(this.pluck("nextElementSibling"))},html:function(t){return t===a?0<this.length?this.dom[0].innerHTML:null:this.each(function(){this.innerHTML=t})},text:function(t){return t===a?0<this.length?this.dom[0].innerText:null:this.each(function(){this.innerText=t})},attr:function(t,e){return"string"==typeof t&&e===a?0<this.length&&"INPUT"===this.dom[0].nodeName&&"text"===this.dom[0].type&&"value"===t?this.dom[0].value:0<this.length?this.dom[0].getAttribute(t)||a:null:this.each(function(){if("object"==typeof t)for(n in t)this.setAttribute(n,t[n]);else this.setAttribute(t,e)})},val:function(t){return"string"==typeof t?this.each(function(){f(this).is("input, textarea")&&(this.value=t)}):this.get(0).value||""},removeAttr:function(t){return"string"!=typeof t?this:this.each(function(){this.hasAttribute(t)&&this.removeAttribute(t)})},offset:function(){var t=this.dom[0].getBoundingClientRect();return{left:t.left+c.body.scrollLeft,top:t.top+c.body.scrollTop,width:t.width,height:t.height}},css:function(t,e){if("string"==typeof t&&(t=l(t)),e===a&&"string"==typeof t)return this.dom[0].style[t]||window.getComputedStyle(this.dom[0]).getPropertyValue(t);var i={};if("string"!=typeof t)for(var n in t)i[l(n)]=t[n];else i[t]=e;return this.each(function(t,e){for(var n in i)e.style[n]=i[n]})},index:function(t){return this.dom.indexOf(f(t).get(0))},hasClass:function(t){return e(t).test(this.dom[0].className)},addClass:function(t){return this.each(function(){f(this).hasClass(t)||(this.className+=(this.className?" ":"")+t)})},removeClass:function(t){return this.each(function(){this.className=this.className.replace(e(t)," ").trim()})},toggleClass:function(t,e){return this.each(function(){e!==a&&!e||f(this).hasClass(t)?f(this).removeClass(t):f(this).addClass(t)})}},["width","height"].forEach(function(t){f.fn[t]=function(){return this.offset()[t]}});var t={append:"beforeEnd",prepend:"afterBegin",before:"beforeBegin",after:"afterEnd"};for(n in t)f.fn[n]=function(e){return function(t){return this.each(function(){this["insertAdjacent"+(t instanceof Element?"Element":"HTML")](e,t)})}}(t[n]);return h.prototype=f.fn,f}();"$"in window||(window.$=Zepto),function(c){var u=c.qsa,s={},e=1;function l(t){return t._zid||(t._zid=e++)}function o(t,e,n,i){var r,o;return(e=h(e)).ns&&(o=e.ns,r=new RegExp("(?:^| )"+o.replace(" "," .* ?")+"(?: |$)")),(s[l(t)]||[]).filter(function(t){return t&&(!e.e||t.e==e.e)&&(!e.ns||r.test(t.ns))&&(!n||t.fn==n)&&(!i||t.sel==i)})}function h(t){var e=(""+t).split(".");return{e:e[0],ns:e.slice(1).sort().join(" ")}}function i(n,t,i,r,o){var e=l(n),a=s[e]||(s[e]=[]);t.split(/\s/).forEach(function(t){var e=c.extend(h(t),{fn:i,sel:r,del:o,i:a.length});a.push(e),n.addEventListener(e.e,o||i,!1)})}function r(e,t,n,i){var r=l(e);(t||"").split(/\s/).forEach(function(t){o(e,t,n,i).forEach(function(t){delete s[r][t.i],e.removeEventListener(t.e,t.del||t.fn,!1)})})}c.event={add:function(t,e,n){i(t,e,n)},remove:function(t,e,n){r(t,e,n)}},c.fn.bind=function(t,e){return this.each(function(){i(this,t,e)})},c.fn.unbind=function(t,e){return this.each(function(){r(this,t,e)})};var f=["preventDefault","stopImmediatePropagation","stopPropagation"];c.fn.delegate=function(a,e,s){return this.each(function(t,o){i(o,e,s,a,function(t){for(var e,n,i=t.target,r=u(o,a);i&&r.indexOf(i)<0;)i=i.parentNode;i&&i!==o&&i!==document&&s.call(i,c.extend((e=t,n=c.extend({originalEvent:e},e),f.forEach(function(t){n[t]=function(){return e[t].apply(e,arguments)}}),n),{currentTarget:i,liveFired:o}))})})},c.fn.undelegate=function(t,e,n){return this.each(function(){r(this,e,n,t)})},c.fn.live=function(t,e){return c(document.body).delegate(this.selector,t,e),this},c.fn.die=function(t,e){return c(document.body).undelegate(this.selector,t,e),this},c.fn.trigger=function(e){return this.each(function(){var t=document.createEvent("Events");this.dispatchEvent(t,t.initEvent(e,!0,!1))})},c.fn.submit=function(){return this.each(function(){this.submit()})}}(Zepto),function(t){function e(t){var e={},n=(t=t).match(/(Android)\s+([\d.]+)/),i=t.match(/(iPhone\sOS)\s([\d_]+)/),r=t.match(/(iPad).*OS\s([\d_]+)/),o=t.match(/(webOS)\/([\d.]+)/);return n&&(e.android=!0,e.version=n[2]),i&&(e.ios=!0,e.version=i[2].replace(/_/g,"."),e.iphone=!0),r&&(e.ios=!0,e.version=r[2].replace(/_/g,"."),e.ipad=!0),o&&(e.webos=!0,e.version=o[2]),e}t.os=e(navigator.userAgent),t.__detect=e;var n=navigator.userAgent.match(/WebKit\/([\d.]+)/);t.browser=n?{webkit:!0,version:n[1]}:{webkit:!1}}(Zepto),Zepto.fn.anim=function(t,e,n){var i,r,o=[];for(r in t)"opacity"===r?i=t[r]:o.push(r+"("+t[r]+")");return this.css({"-webkit-transition":"all "+(void 0!==e?e:.5)+"s "+(n||""),"-webkit-transform":o.join(" "),opacity:i})},function(n){var r,o={};n(document).ready(function(){n(document.body).bind("touchstart",function(t){var e,n=Date.now(),i=n-(o.last||n);o.target="tagName"in(e=t.touches[0].target)?e:e.parentNode,r&&clearTimeout(r),o.x1=t.touches[0].pageX,0<i&&i<=250&&(o.isDoubleTap=!0),o.last=n}).bind("touchmove",function(t){o.x2=t.touches[0].pageX}).bind("touchend",function(t){o.isDoubleTap?(n(o.target).trigger("doubleTap"),o={}):0<o.x2?(30<Math.abs(o.x1-o.x2)&&n(o.target).trigger("swipe")&&n(o.target).trigger("swipe"+(0<o.x1-o.x2?"Left":"Right")),o.x1=o.x2=o.last=0):"last"in o&&(r=setTimeout(function(){r=null,n(o.target).trigger("tap"),o={}},250))}).bind("touchcancel",function(){o={}})}),["swipe","swipeLeft","swipeRight","doubleTap","tap"].forEach(function(e){n.fn[e]=function(t){return this.bind(e,t)}})}(Zepto),function($){var jsonpID=0;function empty(){}$.ajaxJSONP=function(t){var e="jsonp"+ ++jsonpID;window[e]=t.success;var n=document.createElement("script");$(n).attr({src:t.url.replace(/callback=\?/,"callback="+e)}),$("head").append(n)},$.ajax=function(options){if(options=options||{},options.url&&/callback=\?/.test(options.url))return $.ajaxJSONP(options);var data=options.data,url=options.url||window.location,callback=options.success||empty,errback=options.error||empty,mime=mimeTypes[options.dataType],content=options.contentType,cache=options.cache,method=options.type||"GET",xhr=new XMLHttpRequest,ts,ret,url;xhr.onreadystatechange=function(){if(4==xhr.readyState)if(200<=xhr.status&&xhr.status<300||0==xhr.status)if(mime==mimeTypes.json){var result,error=!1;try{result=JSON.parse(xhr.responseText)}catch(t){error=t}error?errback(xhr,"parsererror",error):callback(result,"success",xhr)}else if(mime==mimeTypes.script){var result,error=!1;try{result=eval(xhr.responseText)}catch(t){error=t}error?errback(xhr,"parsererror",error):callback(result,"success",xhr)}else callback(xhr.responseText,"success",xhr);else errback(xhr,"error")},mime==mimeTypes.script&&(cache=!1),!1===cache&&"GET"===method&&(ts=(new Date).getTime(),ret=url.replace(rts,"$1_="+ts+"$2"),url=ret+(ret===url?(rquery.test(url)?"&":"?")+"_="+ts:"")),url=url+(rquery.test(url)?"&":"?")+"format=mobile",xhr.open(method,url,!0),mime&&xhr.setRequestHeader("Accept",mime),data instanceof Object&&(data=JSON.stringify(data),content=content||"application/json"),content&&xhr.setRequestHeader("Content-Type",content),xhr.setRequestHeader("X-Requested-With","XMLHttpRequest"),xhr.send(data)};var mimeTypes=$.ajax.mimeTypes={json:"application/json",xml:"application/xml",html:"text/html",text:"text/plain",script:"text/javascript, application/javascript"},rquery=/\?/,rts=/(\?|&)_=.*?(&|$)/;$.get=function(t,e){$.ajax({url:t,success:e})},$.post=function(t,e,n,i){e instanceof Function&&(i=i||n,n=e,e=null),$.ajax({type:"POST",url:t,data:e,success:n,dataType:i})},$.getJSON=function(t,e){$.ajax({url:t,success:e,dataType:"json"})},$.getScript=function(t,e){$.ajax({url:t,success:e,dataType:"script"})},$.fn.load=function(t,e){if(!this.dom.length)return this;var n,i=this,r=t.split(/\s/);return 1<r.length&&(t=r[0],n=r[1]),$.get(t,function(t){i.html(n?$(document.createElement("div")).html(t).find(n).html():t),e&&e()}),this}}(Zepto),function(){var e,n=[];Zepto.fn.remove=function(){return this.each(function(t){"IMG"==t.tagName&&(n.push(t),t.src="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=",e&&clearTimeout(e),e=setTimeout(function(){n=[]},6e4)),t.parentNode.removeChild(t)})}}(),function(o){Zepto.fn.autoHeight=function(){return this.each(function(t,e){for(var n=0,t=0;t<e.childNodes.length;t++)1==e.childNodes[t].nodeType&&(n+=e.childNodes[t].offsetHeight+15);e.style.maxHeight=(n?n+5:0)+"px"})},o(document).ready(function(){o.os.ios&&o("html").addClass("ios"),isNaN(window.orientation)||o(window).bind("orientationchange",function(){var t=0==window.orientation||180==window.orientation?"portrait":"landscape";o("html").removeClass("portrait").removeClass("landscape").addClass(t)}).trigger("orientationchange");var t=o.os.ios||o.os.android?"tap":"click";o(".m-panel-header").live(t,function(){var t,e=o(this).closest("li"),n=o(".m-panel-content",e);o(e).hasClass("m-panel-open")?(e.attr("class",""),n.css("max-height","")):(o(e).addClass("m-panel-open"),(t=o(n).attr("data-load-url"))?(o("img",n).show(),n.css("max-height","20px"),o.getScript(t)):(o("#post_comment",n).show(),n.autoHeight()))}),o(".m-description .more").live(t,function(){o(this).closest(".m-description").addClass("open").removeClass("closed")}),0<o(".hidden-facet").dom.length&&(o(".more-facets").show(),o(".more-facets a").live("click",function(t){t.preventDefault();var e=o(this).attr("data-label");o(this).attr("data-label",o(this).text()),o(this).text(e);var n=o(".hidden-facet").dom,i=n[n.length-1].offsetTop;o(".hidden-facet").toggleClass("show"),o("html, body").each(function(){this.scrollTop=i})})),o('a[href="#post_comment"]').live("click",function(){o("#post_comment").show()}),o("#post_comment .left-button a").live("click",function(t){t.preventDefault(),o("body").append('<iframe id="comment_post_iframe"></iframe>'),o("#post_comment form").attr("target","comment_post_iframe").submit();var e=o("#post_comment");o(e.get(0).parentNode).append("<div>"+e.attr("data-message")+"</div>"),e.remove()}),o("#post_comment .right-button a").live("click",function(t){t.preventDefault(),o("#post_comment form textarea").val("");var e=o("#post_comment").hide().get(0);o(e.parentNode.parentNode).hasClass("m-panel-open")&&(o(e.parentNode.parentNode).attr("class",""),o(e.parentNode).css("max-height",""))}),o(".search-box input").bind("change focus blur keyup mouseup",function(t){""!=o(this).val()?o(".search-field-clear-button").show():o(".search-field-clear-button").hide()}).trigger("change"),o(".search-field-clear-button").bind("click",function(t){t.preventDefault(),t.stopPropagation(),o(".search-box input").val("").trigger("change")}),o(".search-field-side-button").bind("click",function(t){var e="m-sidebar-open"==document.body.className;document.body.className=e?"":"m-sidebar-open"}),o(".search-field-submit-button").bind("click",function(){o(".search-top form").submit()}),o("#credit-cards .m-navigation li:last-child>a").bind("click",function(t){t.preventDefault();var e=o(this);if(!confirm(e.attr("data-confirm")))return!1;o.get(e.attr("href"),function(){e.closest("li").closest("li").remove()})}),o("#credit-cards .default").bind("click",function(t){t.preventDefault();var i=o(this);i.attr("data-remote")&&o.get(i.attr("href"),function(){var n;o("#credit-cards .default").each(function(t,e){e.hasAttribute("data-remote")||(n=o(e).html(),o(e).attr("data-remote","true")),o(e).html(i.html())}),i.html(n),i.removeAttr("data-remote")})}),o('.m-list a[rel*="http://opds-spec.org/acquisition/buy"]').live("click",function(t){var e=o(this);e.hasClass("buy")&&(t.preventDefault(),e.attr("class","confirm").html(e.attr("data-label")))}),o('a[data-rel="submit"]').live("click",function(t){t.preventDefault(),o(this).closest("form").append('<input type="hidden" name="commit"/>').submit()}),o("a[data-method]").live("click",function(t){t.preventDefault();var e=o(this).attr("href"),n=o(this).attr("data-method"),i=o('meta[name="csrf-param"]').attr("content"),r=o('meta[name="csrf-token"]').attr("content");o("body").append('<form id="submit-with-method" action="'+e+'" method="'+n+'"><input type="hidden" name="'+i+'" value="'+r+'"/></form>'),o("#submit-with-method").submit()}),o('[href="#price-range"] img').hide(),o("#price-range.hide").hide(),o('[href="#price-range"]').live("click",function(t){t.preventDefault(),o("#price-range").toggle(),o("img",this).toggle()}),o('[href="#price-range-submit"]').live("click",function(t){t.preventDefault();var e=o(this).closest("form"),n={};n.from_price=e.find("[name=from_price]").val(),n.to_price=e.find("[name=to_price]").val();var i=e.attr("action"),r={};for(key in n)r[key]=parseInt(n[key]);0<r.from_price&&0<r.to_price&&r.from_price<r.to_price&&(i=i.replace("__range__",r.from_price+"|"+r.to_price),window.location.href=i)}),o(".show_password").live("click",function(t){var e=o("#user_password");"password"==e.attr("type")?e.attr("type","text"):e.attr("type","password")})})}(Zepto);