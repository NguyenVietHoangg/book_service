
#modal-default1.modal.fade.in
  .modal-dialog(style="width: 960px; margin: 30px auto;")
    .modal-content
      .modal-body
        .categories-list(style="margin-bottom: 10px;")
          .form-group            
            label Danh s√°ch th·ªÉ lo·∫°i &nbsp;            
            select#category-id1.form-control(onchange="loadStory()")
              each item, index in categories
                option(value=item.id) !{item.name}
        ul.nav.nav-tabs
          li.active
            a(href='#tab_1' data-toggle='tab' onclick="loadStory()") Danh s√°ch B√†i Vi·∫øt
          li
            a(href='#tab_2' data-toggle='tab') Th√™m B√†i V√†o Danh M·ª•c N√†y
          li
            a(href='#tab_3' data-toggle='tab') V·ªã Tr√≠ Mark
          li
            a.suacategory(href='' target="_blank" class="btn") S·ª≠a Danh M·ª•c
        .tab-content
          label(for='auto-search')
          #tab_1.tab-pane.active
            .form-group
              input#auto-search-in-category.form-control(type='text' placeholder='T√¨m ki·∫øm tin t·ª©c trong danh m·ª•c n√†y')
              span(id="tbremove" style="color:red; font-style: italic; font-weight:bold")
            table.table.table-bordered#story-in-category(data-buttons-toolbar='.buttons-toolbar' data-toolbar-align='unset' data-search='false' data-icons-prefix='fa' data-show-refresh='false' data-show-toggle='false' data-show-columns='true' data-show-export='true' data-detail-view='false' data-detail-formatter='detailFormatter' data-minimum-count-columns='2' data-show-pagination-switch='false' data-pagination='true' data-id-field='id' data-page-list='[5,All]' data-show-footer='false' data-side-pagination='server' data-url='/admin/story/ajax-list' data-query-params='queryParams' data-response-handler='responseHandler')
            #paginationStory
          #tab_2.tab-pane
            .form-group
              input#auto-search-story.form-control(style='width: 500px; display: inline-block; margin-right: 10px;' type='text' placeholder='Nh·∫≠p t√™n tin t·ª©c ƒë·ªÉ t√¨m ki·∫øm' autocomplete="off")
              select#positionType.form-control(style='width: 100px; display: inline-block; margin-right: 10px;')
                option(value='') M·∫∑c ƒë·ªãnh
                option(value='Slide') Slide
                option(value='New') New
                option(value='Focus') Focus
              select#positionSet.form-control(style='width: 100px; display: inline-block;')
                option(value='') M·∫∑c ƒë·ªãnh
                option(value=1) 1
                option(value=2) 2
                option(value=3) 3
                option(value=4) 4
                option(value=5) 5
              input#id-story-set(type='hidden')
              input#id-type-set(type='hidden')
              input#category-id(type="hidden" name="categoryId")
            table.table.table-bordered#story-list-search
            .form-group
              .btn.btn-primary#add-collectionanh(onclick='addStory()') ADD
          #tab_3.tab-pane
            .row 
              .col-lg-12.col-md-12 
                label Ch·ªçn V√πng C√†i ƒê·∫∑t
            .row
              .col-lg-1.col-md-1
                .form-group
                  .btn.btn-primary.inputCheck(data='Slide') Slide
              .col-lg-1.col-md-1
                .form-group
                  .btn.btn-primary.inputCheck(data='Focus') Focus
              .col-lg-1.col-md-1
                .form-group
                  .btn.btn-primary.inputCheck(data='New') New
            .row
              .col-lg-12.col-md-12.list-story-category-position
      .modal-footer
        button#close-modal.btn.btn-default(type='button' data-dismiss='modal') Close
script.
  $('#auto-search-story').keyup(function () {
    loadSearch();
  });

  $('#auto-search-in-category').keyup(function () {
    loadStory();
  });

  $('#modal-default1').on("hidden.bs.modal", function() {
    $('.inputCheck').removeClass('btn-success')
    $('.inputCheck').addClass('btn-primary')
    $('.list-story-category-position').html('')
    $('#id-story-set').val('')
    $('.item-search-story').removeClass('bg-maroon').addClass('bg-olive')
    $('#auto-search-story').val('')
    $('#story-list-search').html('')
  });

  $('.inputCheck').click(function() {
    var type = $(this).attr('data')
    listStoryCheck(type)
    $('.inputCheck').removeClass('btn-success')
    $('.inputCheck').addClass('btn-primary')
    $(this).removeClass('btn-primary')
    $(this).addClass('btn-success')
  })

  function loadSearch() {
    var keySearch = $('#auto-search-story').val()
    $('#id-story-set').val('')
    $('.item-search-story').removeClass('bg-maroon').addClass('bg-olive')
    if (keySearch.length <3) {
      $('#story-list-search').html('')
      return
    }
    $.ajax({
      url: '/admin/story/ajax-list?keySearch='+$('#auto-search-story').val(),
      success: function (res) {
        if (res.total) {
          var list = [];
          for(var i = 0; i < res.rows.length; i++) {
            var text = '<span class="btn bg-olive margin item-search-story" id="item-search-'+res.rows[i].id+'" onclick="chooseStory('+res.rows[i].id+')">'+res.rows[i].name+'</span>'
            list.push(text);
          }
          $('#story-list-search').html(list.join(''))
        } else {
          $('#story-list-search').html('')
        }
      }
    })
  }

  function listStoryCheck(type='Slide') {
    var idCate = $('#category-id1').val()
    $.ajax({
      url: "/story/checkpositioncategory",    
      method: "post",
      data:
      {              
        idCate: idCate,
        nameclick: type
      },
      success: function (res) {
        $('.list-story-category-position').html(res.layoutList)
        if (!res.layoutList) {
          $('.list-story-category-position').html('Ch∆∞a c√†i ƒë·∫∑t v·ªã tr√≠ cho '+ type)
        }
      }
    });
  }

  function loadStory() {
    $.ajax({      
      url: '/admin/story/ajax-list?categoryId='+$('#category-id1').val()+'&keySearch='+$('#auto-search-in-category').val(),
      success: function (res) {     
        if (res.rows) {
          var cateId = $('#category-id1').val();
          let totalPage = res.total / res.limit 
          let checkInterger = Number.isInteger(totalPage)
          if(checkInterger == false) {
            totalPage = Math.floor(res.total / res.limit) + 1;            
          }
          else {
            totalPage = Math.floor(res.total / res.limit);            
          }
          var pagination =[];
          var list = [];
          const layoutListSmall = res.rows.map(item => {
            var text = '<p id="item-story-'+item.id+'" style="font-size: 20px;"> <span style="color: #0f92d0;">'+item.id+' - '+item.name+'</span> <span title="x√≥a" style="cursor: pointer;" onclick="removeStory('+item.id+', '+cateId+')">üóëÔ∏è</span></p>'
            return text
          })
          for(let j=1; j<=totalPage;j++){
            let offset = (j-1)*res.limit
            let text1 = `<button class="btn btn-sm btnpage" type="button" style="background-color:#2b9cec; font-size: 18px; color: white; margin-right: 5px;" id="pagination${j}" value=${j} onclick="paginationStory(${offset},${j})">${j}</button>`
            pagination.push(text1)             
          }
          $('#story-in-category').html(layoutListSmall.join(''))
          //- $('#paginationStory').html(pagination.join(''))
          $('#paginationStory').html('T√¨m ƒë∆∞·ª£c <span style="color:red; font-weight: bold;">'+res.total+'</span> b√†i vi·∫øt')
        } else {
          $('#story-in-category1').html('')
        }
      }
    })
  }

  function chooseStory (id) {
    $('.item-search-story').removeClass('bg-maroon').addClass('bg-olive')
    $('#item-search-'+id).removeClass('bg-olive').addClass('bg-maroon')
    $('#id-story-set').val(id)
  }

  function addStory () {
    var idChoose = $('#id-story-set').val()
    var positionSet = $('#positionSet').val()
    var positionType = $('#positionType').val()
    if (!idChoose) {
      $.notify("Vui l√≤ng ch·ªçn b√†i vi·∫øt", { position:"top right", className: "error" });
      return
    }
    if ((positionSet && !positionType) || (!positionSet && positionType)) {
      $.notify("N·∫øu set v·ªã tr√≠ th√¨ ph·∫£i ƒë·∫£m b·∫£o ƒë·ªìng th·ªùi v√πng ch·ªçn (Focus, New, Slide) v√† th·ª© t·ª± (1,2,3,4,5)", { position:"top right", className: "error" });
      return
    }
    Swal.fire({
      title: 'B·∫°n c√≥ ch·∫Øc ch·∫Øn th√™m b√†i vi·∫øt v√†o danh m·ª•c n√†y?',
      text: "D·ªØ li·ªáu ƒë∆∞·ª£c th√™m v√†o danh m·ª•c!",
      icon: 'warning',
      showCancelButton: true,
      confirmButtonColor: '#3085d6',
      cancelButtonColor: '#969696',
      confirmButtonText: 'ƒê·ªíNG √ù',
      cancelButtonText: 'H·ª¶Y B·ªé',
    }).then((result) => {
      if (result.value) {
        $.ajax({
          url: '/admin/category/addstory',
          method: 'post',
          data: {
            categoryId: $('#category-id1').val(),
            storyId: idChoose,
            position: positionSet,
            positionType: positionType
          },
          success: function (res) {
            $.notify("Success", { position:"bottom right", className: "success" });
            if (positionType) {
              $('.inputCheck').addClass('btn-primary')
              $('.list-story-category-position').html('')
              $('#id-story-set').val('')
              $('.item-search-story').removeClass('bg-maroon').addClass('bg-olive')
              $('#auto-search-story').val('')
              $('#story-list-search').html('')
            }
          }
        })
      }          
    })
  }
  
  function removeStory (storyId, categoryId) {
    Swal.fire({
      title: 'B·∫°n c√≥ ch·∫Øc ch·∫Øn x√≥a b√†i vi·∫øt kh·ªèi danh m·ª•c n√†y?',
      text: "B√†i vi·∫øt s·∫Ω b·ªã x√≥a kh·ªèi danh m·ª•c!",
      icon: 'warning',
      showCancelButton: true,
      confirmButtonColor: '#3085d6',
      cancelButtonColor: '#969696',
      confirmButtonText: 'ƒê·ªíNG √ù',
      cancelButtonText: 'H·ª¶Y B·ªé',
    }).then((result) => {
      if (result.value) {
        $('#tbremove').text('')
        $.ajax({
          url: '/admin/category/removestory',
          method: 'delete',
          data: {
            categoryId: categoryId,
            storyId: storyId
          },
          success: function (res) {
            console.log(res)
            if(res == "X√≥a th√†nh c√¥ng"){
              $.notify("Success", { position:"bottom right", className: "success" });
              $('#item-story-'+storyId).remove();
            }
            else{
              $('#tbremove').text("Error! B√†i vi·∫øt hi·ªán t·∫°i ƒëang ch·ªâ thu·ªôc th·ªÉ lo·∫°i tr√™n, b·∫°n vui l√≤ng kh√¥ng x√≥a b√†i vi·∫øt kh·ªèi th·ªÉ lo·∫°i n√†y!");
            }
          }
        })
      }          
    })
  }


  function paginationStory(offset,page){     
      $('#savevaluepagination').val(page)
      let value =  $('#savevaluepagination').val()      
      //- let x = document.querySelectorAll(".btnpage")      
      //- for (i = 0; i < x.length; i++) {
      //-   x[i].style.backgroundColor = "gray"              
      //- }      
      $.ajax({
        url: '/admin/story/ajax-list?categoryId='+$('#category-id1').val()+'&keySearch='+$('#auto-search-in-category').val()+'&offset='+offset,
        success: function (res) { 
        if (res.rows) {        
          let totalPage = res.total / res.limit 
          let checkInterger = Number.isInteger(totalPage)
          if(checkInterger == false){
            totalPage = Math.floor(res.total / res.limit) + 1;            
          }
          else{
            totalPage = Math.floor(res.total / res.limit);            
          }
          var pagination =[];
          var list = [];
          const layoutListSmall = res.rows.map(item => {
            text = '<p id="item-story-'+item.id+'" style="font-size: 20px;"> <span style="color: #0f92d0;">'+item.id+' - '+item.name+'</span> <span title="x√≥a" style="cursor: pointer;" onclick="removeStory('+item.id+', '+item.categories[0].id+')">üóëÔ∏è</span></p>'
            return text
          })
          for(let j=1; j<=totalPage;j++){
            let offset = (j-1)*res.limit
            let text1 = `<button class="btn btn-sm btnpage" type="button" style="background-color:#2b9cec; font-size: 18px; color: white; margin-right: 5px;" id="pagination${j}" value=${j} onclick="paginationStory(${offset},${j})" >${j} </button>`
            pagination.push(text1)             
          }
          $('#story-in-category').html(layoutListSmall.join(''))
          $('#paginationStory').html(pagination.join(''))
          $('#pagination'+page).css("background-color", "green")
        } else {
          $('#story-in-category1').html('')
        }        
      }
    })
  }
  
    
